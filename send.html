<script type="text/javascript">
  RED.nodes.registerType('send-message', {
    category: 'Whatsapp Bot',
    color: '#25D400',
    defaults: {
      name: {
        value: ''
      },
      sendTo: {
          value: 0,
          required: true,
          validate:RED.validators.regex(/^\d{10}/)
      },
      messageContent : {
          value:""
      },
      client: {
        type: 'whatsapp-client',
        required: true
      }
    },
    inputs: 1,
    outputs: 1,
    align: "left",
    icon: 'whatsapp.png',
    paletteLabel: 'Send Message',
    label: function () {
      return this.name || 'Send Message'
    }
  })
</script>

<script type="text/html" data-template-name="send-message">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>

  <div class="form-row">
    <label for="node-input-sendTo"><i class="fa fa-tag"></i> Send To</label>
    <input type="text" id="node-input-sendTo" placeholder="Phone Number">
  </div>

  <div class="form-row">
    <label for="node-input-messageContent"><i class="fa fa-tag"></i> Message </label>
    <input type="text" id="node-input-messageContent" placeholder="Message">
  </div>
  
</script>

<script type="text/html" data-help-name="whatsapp-bot">
  <p>Used to send/receive data from a Whatsapp Client. Each Bot node by default subscribes to <code>onMessage</code>, <code>onAck</code> and <code>onAddedToGroup</code> events</p>
  
  <h3>Input</h3>
  <ol class="node-ports">
     <li>Input
      <dl class="message-properties">
        <dt>topic <span class="property-type">String</span></dt>
        <dd>API/Event name</dd>
    </dl>
         <dl class="message-properties">
             <dt>payload <span class="property-type">Array</span></dt>
             <dd>Args to use to call the API</dd>
         </dl>
     </li>
  </ol>

  <h3>Outputs</h3>
  <ol class="node-ports">
     <li>Output
         <dl class="message-properties">
             <dt>payload <span class="property-type">Array</span></dt>
             <dd>Args result of the api/event</dd>
         </dl>
         <dl class="message-properties">
             <dt>topic <span class="property-type">String</span></dt>
             <dd>API name</dd>
         </dl>
     </li>
  </ol>

  <h3>Examples</h3>

  <p>If you want to subscribe to <code>onParticipantsChanged</code> or <code>onLiveLocation</code>, send the request with only the <code>chatId</code> and 
    it will subscribe for those events on that chat. The output <code>msg</code> contain also a property <code>chatId</code> with the id of the chat that has emitted the event</p>

  <p>Function node code for calling <code>sendMessageToId</code> API:</p>
  <code>
    msg.payload = { topic: 'sendMessageToId', payload: [ 'xxxxxxxxxxxx@c.us', 'Hello from Node-Red'] }
    return msg
  </code>

  <p>Result of previous message:</p>
  <code>
    { topic: 'sendMessageToId', payload: [ 'true_xxxxxxxxxx@c.us_xxxxxxxxxxxx' ], origin: { //the origin message request } }
  </code>

 <p>Output for an <code>onMessage</code> event:</p>
 <code>
  { topic: 'onMessage', payload: [ { // the message object } ] }
 </code>
  
  <h3>References</h3>
    <ul>
        <li><a href="https://github.com/danielcardeenas/sulla">APIs</a> - List of available apis</li>
        <li><a href="https://github.com/robertsLando/node-red-contrib-whatsappbot">GitHub</a> - the node github repository</li>
    </ul>
  
  </script>